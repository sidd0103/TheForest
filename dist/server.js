!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n.w={},n(n.s=18)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.World=void 0;var i=r(n(17));r(n(16));function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(){l(this,e)}return c(e,null,[{key:"init",value:function(e,t){this.entities=[],this.seed=t,null==this.seed&&(this.seed=Math.random().toString(36)),this.map=new v(e,this.seed)}},{key:"getMap",value:function(){return{seed:this.seed,size:this.map.mapSize}}}]),e}();t.World=p,f(p,"map",void 0),f(p,"seed",void 0),f(p,"size",void 0),f(p,"changes",{});var d=function e(){l(this,e),this.prevHealth=null,this.maxHealth=100,this.regenAmount=50,this.health=100,this.lastHealthUpdate=null,this.regenRate=1e3},y=function(e){function t(e,n,i,r,o){var s;return l(this,t),(s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))).staticObject=e,s.collidable=n,s.sprite=i,s.pos=r,s.offset=o,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d),c(t,[{key:"getPixelPos",value:function(){return{x:Math.round(this.pos.x*p.map.tileSize),y:Math.round(this.pos.y*p.map.tileSize-p.map.tileSize/2+5)}}}]),t}(),h=function e(t,n,i){l(this,e),this.sprite=n,this.collidable=t,this.pos=i},v=function(){function e(t,n){var r=this;l(this,e),this.seed=n,this.randSeedVal=(0,i.default)(this.seed),this.tileSize=56,this.tilesJSON="",this.mapSize=t,this.offsets={center:{x:0,y:this.tileSize/2+5}},this.tiles=o(Array(this.mapSize)).map(function(e){return Array(r.mapSize)}),this.staticEntities=o(Array(this.mapSize)).map(function(e){return Array(r.mapSize)}),this.generateRandomTiles(),this.generateRandomEntities(),this.bounds={x:{max:this.tiles[0][this.mapSize-1].pos.x*this.tileSize,min:this.tiles[0][0].pos.x*this.tileSize},y:{max:this.tiles[this.mapSize-1][0].pos.y*this.tileSize,min:this.tiles[0][0].pos.y*this.tileSize}}}return c(e,[{key:"generateRandomTiles",value:function(){for(var e=["LIGHT_GRASS_TILE","DARK_GRASS_TILE"],t=0;t<this.mapSize;t++)for(var n={x:0,y:-1*this.mapSize/2+t},i=0;i<this.mapSize;i++){n.x=-1*this.mapSize/2+i;var r=e[0];Math.floor(100*this.randSeedVal())>50&&(r=e[1]),this.tiles[t][i]=new h(!1,r,{x:n.x,y:n.y})}}},{key:"generateRandomEntities",value:function(){for(var e=["BRIGHT_GREEN_TREE"],t=0;t<this.mapSize;t++)for(var n={x:0,y:-1*this.mapSize/2+t},i=0;i<this.mapSize;i++){n.x=-1*this.mapSize/2+i;var r=null;Math.floor(100*this.randSeedVal())>70&&(r=0),null!=r&&(this.staticEntities[t][i]=new y(!0,!0,e[r],{x:n.x,y:n.y},this.offsets.center))}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateLoop=void 0;var i=n(2),r=n(3);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s;return t=e,s=[{key:"init",value:function(){this.lastTime=(new Date).getTime(),this.serverTime=0,this.dt=0}},{key:"run",value:function(){var e=this;setTimeout(function t(){e.dt=(new Date).getTime()-e.lastTime,e.serverTime+=e.dt,e.lastTime=(new Date).getTime(),setTimeout(t,15)},15),setTimeout(function t(){var n={serverTime:e.serverTime,playerData:i.PlayerList.players};r.SocketServer.app.sockets.emit("playerPayload",n),setTimeout(t,45)},45)}}],(n=null)&&o(t.prototype,n),s&&o(t,s),e}();t.UpdateLoop=a,s(a,"lastTime",void 0),s(a,"serverTime",void 0),s(a,"dt",void 0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerList=void 0;var i,r=(i=n(8))&&i.__esModule?i:{default:i},o=n(7),s=n(6);n(1);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}var p=function(){function e(){u(this,e)}return f(e,null,[{key:"add",value:function(e,t,n){this.players[e]=new d(e,t,n)}},{key:"updatePositions",value:function(e){for(var t in this.players)this.players[t].updatePos(e)}},{key:"remove",value:function(e){delete this.players[e]}}]),e}();t.PlayerList=p,function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(p,"players",{});var d=function(e){function t(e,n,i){var o;return u(this,t),(o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{x:0,y:0},{x:0,y:0}))).token=e,o.username=n,o.charClass=r.default.charClass[i],o.keysPressed={},o.constants={leftKey:65,rightKey:68,upKey:87,downKey:83,enterKey:13},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.FreeEntity),f(t,[{key:"handleKeyPressAndMove",value:function(e,t,n){if(null!=e){this.keysPressed=e;Math.abs((new Date).getTime()-t);this.updatePos(n)}}},{key:"updatePos",value:function(e){var t={x:0,y:0};this.keysPressed[this.constants.leftKey]&&!this.keysPressed[this.constants.rightKey]&&(t.x=-1*this.charClass.stats.speed*e),this.keysPressed[this.constants.rightKey]&&!this.keysPressed[this.constants.leftKey]&&(t.x=this.charClass.stats.speed*e),this.keysPressed[this.constants.upKey]&&!this.keysPressed[this.constants.downKey]&&(t.y=-1*this.charClass.stats.speed*e),this.keysPressed[this.constants.downKey]&&!this.keysPressed[this.constants.upKey]&&(t.y=this.charClass.stats.speed*e),0!==t.y&&0!==t.x&&(t.x=t.x/1.4,t.y=t.y/1.4),t.x=Math.trunc(t.x),t.y=Math.trunc(t.y),this.willMove=t,s.CollisionListener.checkCollisionsAndMove(this)}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketServer=void 0;var i,r=n(5),o=(i=n(9))&&i.__esModule?i:{default:i},s=n(2),a=n(0),l=n(1);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"start",value:function(){var e=this;console.log("Starting Socket Server on port: "+r.HttpServer.port),this.app=(0,o.default)(r.HttpServer.server),this.app.on("connect",function(t){console.log("[CONNECTION] New Client: "+t.id),t.on("playerData",function(e){console.log(e),s.PlayerList.add(t.id,e.username,e.playerClass),console.log("[EVENT] Added Player of username: "+e.username),t.emit("playerAdded")}),t.on("syncClocks",function(e){var n={currentTime:(new Date).getTime(),serverTime:l.UpdateLoop.serverTime};t.emit("serverTime",n)}),t.on("requestMap",function(){t.emit("map",a.World.getMap(),a.World.changes)}),t.on("requestPlayers",function(){t.emit("players","")}),t.on("playerKeys",function(e){s.PlayerList.players[t.id].handleKeyPressAndMove(e.keys,e.timestamp,e.dt)}),t.on("disconnect",function(){s.PlayerList.remove(t.id),e.app.sockets.emit("disconnectEvent",t.id)}),t.on("worldChange",function(e){null!=a.World.map.staticEntities[e.row][e.col]&&(a.World.map.staticEntities[e.row][e.col].health=e.data.health,!1===e.data.exists&&(a.World.map.staticEntities[e.row][e.col]=null),e.data.broadcast&&t.broadcast.emit("worldChange",e),a.World.changes[e.row+" "+e.col]=e,e.data.health>=100&&delete a.World.changes[e.row+" "+e.col])})})}}],(n=null)&&u(t.prototype,n),i&&u(t,i),e}();t.SocketServer=c,function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(c,"app",void 0)},function(e,t){e.exports=require("http")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpServer=void 0;var i=a(n(4)),r=a(n(14)),o=a(n(13)),s=a(n(12));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"start",value:function(e){var t=this;this.port=e,this.port=process.env.PORT||e,this.app=(0,r.default)(),this.server=i.default.Server(this.app),this.server.listen(this.port,function(e){if(e)throw e;console.log("Started server on port: "+t.port)}),this.app.get("/",function(e,t){t.sendFile(o.default.join(__dirname,"..","index.html"))}),this.app.get("/*",function(e,t,n){var i=e.params[0];t.sendFile(o.default.join(__dirname,"..",i))}),this.app.use("/timesync",s.default.requestHandler)}}],(n=null)&&l(t.prototype,n),a&&l(t,a),e}();t.HttpServer=c,u(c,"server",void 0),u(c,"port",void 0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollisionListener=void 0;var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"checkCollisionsAndMove",value:function(e){var t=this;!function n(r){var o=null;r.y<i.World.map.mapSize&&r.y>=0&&r.x<i.World.map.mapSize&&r.x>=0&&(o=i.World.map.staticEntities[r.y][r.x]);i.World.map.tileSize;if(null!=o&&o.collidable){var s=o.getPixelPos(),a={x:e.pos.x+e.willMove.x-s.x,y:e.pos.y+e.willMove.y-s.y},l={x:e.pos.x-s.x,y:e.pos.y-s.y},u=e.getFutureIndex();u.y!==r.y?n(u):l.y<t.backOffset&&a.y>=t.backOffset?e.willMove.y>0&&(e.willMove.y=t.backOffset+s.y-e.pos.y):l.y>t.frontOffset&&a.y<=t.frontOffset?e.willMove.y<0&&(e.willMove.y=t.frontOffset+s.y-e.pos.y):l.y===t.backOffset&&e.willMove.y>0?e.willMove.y=0:l.y===t.frontOffset&&e.willMove.y<0&&(e.willMove.y=0)}var c=0,f=0;e.pos.x+c/2*i.World.map.tileSize>=i.World.map.bounds.x.max&&e.willMove.x>0&&(e.willMove.x=0),e.pos.x-c/2*i.World.map.tileSize<=i.World.map.bounds.x.min&&e.willMove.x<0&&(e.willMove.x=0),e.pos.y+f/2*i.World.map.tileSize>=i.World.map.bounds.y.max-i.World.map.tileSize&&e.willMove.y>0&&(e.willMove.y=0),e.pos.y-f/2*i.World.map.tileSize<=i.World.map.bounds.y.min&&e.willMove.y<0&&(e.willMove.y=0)}(e.getIndex()),e.lastWillMove=e.willMove,e.pos.x+=e.willMove.x,e.pos.y+=e.willMove.y}}],(n=null)&&r(t.prototype,n),o&&r(t,o),e}();t.CollisionListener=s,o(s,"frontOffset",5),o(s,"backOffset",-8)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreeEntity=void 0;var i=n(0);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(this instanceof e?this.constructor:void 0)===e)throw new TypeError("Cannot construct Abstract instances directly");this.pos=t,this.willMove=n,this.lastWillMove={x:0,y:0}}var t,n,o;return t=e,(n=[{key:"getIndex",value:function(){return{x:Math.round(i.World.map.mapSize/2+this.pos.x/i.World.map.tileSize),y:Math.ceil(i.World.map.mapSize/2+this.pos.y/i.World.map.tileSize)}}},{key:"getFutureIndex",value:function(){return{x:Math.round(i.World.map.mapSize/2+(this.pos.x+this.willMove.x)/i.World.map.tileSize),y:Math.ceil(i.World.map.mapSize/2+(this.pos.y+this.willMove.y)/i.World.map.tileSize)}}}])&&r(t.prototype,n),o&&r(t,o),e}();t.FreeEntity=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={charClass:{KNIGHT:{stats:{speed:.7}}}}},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("fs")},function(e,t,n){var i=n(11),r=n(4),o=n(10)("timesync");function s(e,t){var n={id:"id"in t?t.id:null,result:Date.now()};e.setHeader("Content-Type","application/json"),e.status&&e.send?e.status(200).send(JSON.stringify(n)):(e.writeHead(200),e.end(JSON.stringify(n)))}t.createServer=function(){return o("creating a new server"),r.createServer(t.requestHandler)},t.attachServer=function(e,n){if(!(e instanceof r.Server))throw new TypeError("Instance of http.Server expected");o("attach to existing server");var i=e.listeners("request").slice(0);e.removeAllListeners("request");var s=function(e){e=e||"/timesync";var n=new RegExp(e+"($|/(.*))");return o("creating request handler listening on path "+e),function(e,i){return!!n.exec(e.url)&&(t.requestHandler(e,i),!0)}}(n);e.on("request",function(t,n){s(t,n)||i.forEach(function(i){i.call(e,t,n)})})},t.requestHandler=function(e,t){if(o("request "+e.method+" "+e.url+" "+e.method),"POST"==e.method&&!r)return function(e,t){e.body?s(t,e.body):function(e,t){var n="";e.on("data",function(i){(n+=i).length>1e6&&(t(new Error("Too much post data. Killing connection..."),null),e.connection.destroy())}),e.on("end",function(){t(null,JSON.parse(n))})}(e,function(e,n){s(t,n)})}(e,t);if("GET"==e.method){var n=e.url.match(/\/(timesync(.min)?.js)$/),r=n&&n[1];if("timesync.js"===r||"timesync.min.js"===r)return function(e,t){o("serve static file "+t),i.readFile(t,function(n,i){n?(e.writeHead(500),e.end("Error loading "+t.split("/").pop())):(e.setHeader("Content-Type","application/javascript"),e.writeHead(200),e.end(i))})}(t,__dirname+"/../dist/"+r)}t.writeHead(404),t.end("Not found")}},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.src=t},r={spriteSheets:[new i("./src/client/sprites/lofiEnvironment2.png"),new i("./src/client/sprites/players.png"),new i("./src/client/sprites/lofiEnvironment.png"),new i("./src/client/sprites/lofiObj3.png")]};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=(i=n(15))&&i.__esModule?i:{default:i};var o={sprite:{grassTileLight:{file:r.default.spriteSheets[0],static:!0,pos:{x:120,y:168},size:{x:8,y:8}},grassTileDark:{file:r.default.spriteSheets[0],static:!0,pos:{x:112,y:168},size:{x:8,y:8}},brightGreenTree:{file:r.default.spriteSheets[2],static:!0,pos:{x:72,y:32},size:{x:8,y:8}},startParticle:{file:r.default.spriteSheets[3],static:!0,pos:{x:66,y:34},size:{x:4,y:4}},knight:{file:r.default.spriteSheets[1],static:!1,size:{x:8,y:7.99},aPos:{x:0,y:120},animData:{up:[{x:0,y:136},{x:8,y:136},{x:16,y:136}],down:[{x:0,y:128},{x:8,y:128},{x:16,y:128}],right:[{x:0,y:120},{x:8,y:120}],left:[{x:56,y:120},{x:64,y:120}]}}}};t.default=o},function(e,t){e.exports=require("seedrandom")},function(e,t,n){"use strict";var i=n(0),r=n(5),o=n(3),s=n(1);console.log("Creating new game..."),i.World.init(500),console.log("World generated of seed: "+i.World.seed),r.HttpServer.start(4040),o.SocketServer.start(),s.UpdateLoop.init(),s.UpdateLoop.run()}]);